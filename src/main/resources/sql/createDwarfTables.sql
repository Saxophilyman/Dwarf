-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Squads
--
-- | Field        | Type         | Description                               |
-- |--------------|--------------|-------------------------------------------|
-- | squad_id     | INT          | Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð¾Ñ‚Ñ€ÑÐ´Ð°           |
-- | name         | VARCHAR(100) | ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¾Ñ‚Ñ€ÑÐ´Ð°                           |
-- | mission      | VARCHAR(100) | Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð¼Ð¸ÑÑÐ¸Ñ Ð¾Ñ‚Ñ€ÑÐ´Ð°                     |

CREATE table Squads
(
    squad_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name     VARCHAR(100) NOT NULL,
    mission  VARCHAR(100)
);

-- ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ðº Ð¿Ð¾Ð»ÑÐ¼
COMMENT ON COLUMN Squads.squad_id IS 'Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð¾Ñ‚Ñ€ÑÐ´Ð°';
COMMENT ON COLUMN Squads.name IS 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¾Ñ‚Ñ€ÑÐ´Ð°';
COMMENT ON COLUMN Squads.mission IS 'Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð¼Ð¸ÑÑÐ¸Ñ Ð¾Ñ‚Ñ€ÑÐ´Ð°';

-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Dwarves
--
-- | Field        | Type         | Description                               |
-- |--------------|--------------|-------------------------------------------|
-- | dwarf_id     | INT          | Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð³Ð½Ð¾Ð¼Ð°            |
-- | name         | VARCHAR(100) | Ð˜Ð¼Ñ Ð³Ð½Ð¾Ð¼Ð°                                 |
-- | age          | INT          | Ð’Ð¾Ð·Ñ€Ð°ÑÑ‚ Ð³Ð½Ð¾Ð¼Ð°                             |
-- | profession   | VARCHAR(100) | ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ñ Ð³Ð½Ð¾Ð¼Ð°                           |
-- | squad_id     | INT          | Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð¾Ñ‚Ñ€ÑÐ´Ð°
--                                 (NULL, ÐµÑÐ»Ð¸ Ð½Ðµ Ð² Ð¾Ñ‚Ñ€ÑÐ´Ðµ)                  |

CREATE TABLE Dwarves
(
    dwarf_id   INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Ð°Ð²Ñ‚Ð¾Ð¸Ð½ÐºÑ€ÐµÐ¼ÐµÐ½Ñ‚Ð½Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
    name       VARCHAR(100) NOT NULL,
    age        INT CHECK (age >= 0),                             -- Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚
    profession VARCHAR(100),
    squad_id   INT,
    CONSTRAINT fk_dwarves_squad
        FOREIGN KEY (squad_id)
            REFERENCES Squads (squad_id)
            ON DELETE SET NULL
);

-- ðŸ”¹ Ð‘Ð¾Ð»ÐµÐµ Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼Ð¾ Ð¿Ñ€Ð¸ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¼ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ð¹
-- ðŸ”¹ Ð¢Ñ‹ ÑÐ°Ð¼ Ð·Ð°Ð´Ð°Ñ‘ÑˆÑŒ Ð¸Ð¼Ñ Ð²Ð½ÐµÑˆÐ½ÐµÐ³Ð¾ ÐºÐ»ÑŽÑ‡Ð°
-- ðŸ”¹ Ð­Ñ‚Ð¾ Ð¸Ð¼Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð²Ð¸Ð´Ð½Ð¾ Ð² Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ… PostgreSQL, Ð² pgAdmin, EXPLAIN, Ð»Ð¾Ð³Ð°Ñ…
-- ðŸ”¹ Ð›ÐµÐ³ÐºÐ¾ Ð¿ÐµÑ€ÐµÐ¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¸ ALTER, DROP CONSTRAINT, Ð¸ Ñ‚. Ð´.
-- Ð’ Ð¿Ñ€Ð¾Ð¼Ñ‹ÑˆÐ»ÐµÐ½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ñ… (Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ Ñ Ð¼Ð¸ÐºÑ€Ð¾ÑÐµÑ€Ð²Ð¸ÑÐ°Ð¼Ð¸, DevOps, CI/CD, Ð°Ð²Ñ‚Ð¾-Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑÐ¼Ð¸)
-- Ð¿Ð¾Ñ‡Ñ‚Ð¸ Ð²ÑÐµÐ³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ CONSTRAINT ... Ñ ÑÐ²Ð½Ñ‹Ð¼Ð¸ Ð¸Ð¼ÐµÐ½Ð°Ð¼Ð¸.


-- ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸:
COMMENT ON COLUMN Dwarves.dwarf_id IS 'Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð³Ð½Ð¾Ð¼Ð°';
COMMENT ON COLUMN Dwarves.name IS 'Ð˜Ð¼Ñ Ð³Ð½Ð¾Ð¼Ð°';
COMMENT ON COLUMN Dwarves.age IS 'Ð’Ð¾Ð·Ñ€Ð°ÑÑ‚ Ð³Ð½Ð¾Ð¼Ð°';
COMMENT ON COLUMN Dwarves.profession IS 'ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ñ Ð³Ð½Ð¾Ð¼Ð°';
COMMENT ON COLUMN Dwarves.squad_id IS 'Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð¾Ñ‚Ñ€ÑÐ´Ð° (NULL, ÐµÑÐ»Ð¸ Ð½Ðµ Ð² Ð¾Ñ‚Ñ€ÑÐ´Ðµ)';

-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Tasks
--
-- | Field        | Type         | Description                               |
-- |--------------|--------------|-------------------------------------------|
-- | task_id      | INT          | Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð´Ð°Ñ‡Ð¸           |
-- | description  | VARCHAR(255) | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸                           |
-- | priority     | INT          | ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ Ð·Ð°Ð´Ð°Ñ‡Ð¸                          |
-- | assigned_to  | INT          | Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð³Ð½Ð¾Ð¼Ð°, Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð·Ð° Ð·Ð°Ð´Ð°Ñ‡Ñƒ
--                                 (NULL, ÐµÑÐ»Ð¸ Ð½Ðµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð°)                 |
-- | status       | VARCHAR(50)  | Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð·Ð°Ð´Ð°Ñ‡Ð¸
--                         (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 'pending', 'in_progress', 'completed') |

CREATE TABLE Tasks
(
    task_id     INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    description VARCHAR(255) NOT NULL,
    priority    INT CHECK (priority >= 1 AND priority <= 10),
    assigned_to INT,
    status      VARCHAR(50) NOT NULL,

    -- Ð’Ð½ÐµÑˆÐ½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡ Ð½Ð° Ð³Ð½Ð¾Ð¼Ð° (Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ NULL)
    CONSTRAINT fk_task_assignee
        FOREIGN KEY (assigned_to)
        REFERENCES Dwarves (dwarf_id)
        ON DELETE SET NULL,

    -- ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼Ñ‹Ñ… ÑÑ‚Ð°Ñ‚ÑƒÑÐ¾Ð²
    CONSTRAINT chk_task_status
        CHECK (status IN ('pending', 'in_progress', 'completed'))
);

-- ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ðº Ð¿Ð¾Ð»ÑÐ¼
COMMENT ON COLUMN Tasks.task_id IS 'Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð´Ð°Ñ‡Ð¸';
COMMENT ON COLUMN Tasks.description IS 'ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸';
COMMENT ON COLUMN Tasks.priority IS 'ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ Ð·Ð°Ð´Ð°Ñ‡Ð¸ (1â€“10)';
COMMENT ON COLUMN Tasks.assigned_to IS 'Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð³Ð½Ð¾Ð¼Ð°, Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð·Ð° Ð·Ð°Ð´Ð°Ñ‡Ñƒ (NULL, ÐµÑÐ»Ð¸ Ð½Ðµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð°)';
COMMENT ON COLUMN Tasks.status IS 'Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð·Ð°Ð´Ð°Ñ‡Ð¸ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, pending, in_progress, completed)';


-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Items
--
-- | Field        | Type         | Description                               |
-- |--------------|--------------|-------------------------------------------|
-- | item_id      | INT          | Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ð°         |
-- | name         | VARCHAR(100) | ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ð°                         |
-- | type         | VARCHAR(100) | Ð¢Ð¸Ð¿ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ð°
--                                 (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 'weapon', 'armor', 'tool')     |
-- | owner_id     | INT          | Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð³Ð½Ð¾Ð¼Ð°-Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†Ð°
--                                 (NULL, ÐµÑÐ»Ð¸ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚ Ð¾Ð±Ñ‰Ð¸Ð¹)                |

CREATE TABLE Items (
    item_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    type VARCHAR(100) NOT NULL,
    owner_id INT,

    -- Ð’Ð½ÐµÑˆÐ½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡ Ð½Ð° Ð³Ð½Ð¾Ð¼Ð°-Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†Ð° (Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ NULL)
    CONSTRAINT fk_item_owner
        FOREIGN KEY (owner_id)
            REFERENCES Dwarves (dwarf_id)
            ON DELETE SET NULL,

    -- ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼Ñ‹Ñ… Ñ‚Ð¸Ð¿Ð¾Ð² Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ð°
    CONSTRAINT chk_item_type
        CHECK (type IN ('weapon', 'armor', 'tool'))
);

-- ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ðº Ð¿Ð¾Ð»ÑÐ¼
COMMENT ON COLUMN Items.item_id IS 'Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ð°';
COMMENT ON COLUMN Items.name IS 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ð°';
COMMENT ON COLUMN Items.type IS 'Ð¢Ð¸Ð¿ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ð° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ''weapon'', ''armor'', ''tool'')';
COMMENT ON COLUMN Items.owner_id IS 'Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð³Ð½Ð¾Ð¼Ð°-Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†Ð° (NULL, ÐµÑÐ»Ð¸ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚ Ð¾Ð±Ñ‰Ð¸Ð¹)';
